<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree Structures</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/visualizer.css">
</head>
<body>
    <header class="hero">
        <div class="hero-content">
            <h1>Tree Structures</h1>
            <p><a href="../index.html" style="color: #94a3b8; text-decoration: underline;">Home</a> / Binary Search Tree</p>
        </div>
    </header>

    <main class="container">
        <div class="viz-layout">
            <aside class="sidebar-left">
                <div class="panel">
                    <h3>Configuration</h3>
                    <div class="control-group">
                        <select id="algo-select">
                            <option value="bst">Binary Search Tree (BST)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Speed</label>
                        <input type="range" id="speed-slider" min="1" max="100" value="60">
                    </div>
                </div>

                <div class="panel">
                    <h3>Operations</h3>
                    <div class="control-group">
                        <label>Value</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="number" id="val-input" value="50" style="width: 100%; padding: 0.4rem; border:1px solid #e2e8f0; border-radius: 6px;">
                            <button id="btn-rand" class="btn-control" style="flex:0.4;">ðŸŽ²</button>
                        </div>
                    </div>

                    <div class="button-row">
                        <button id="btn-insert" class="btn-control btn-primary">Insert</button>
                        <button id="btn-search" class="btn-control">Search</button>
                    </div>

                    <div class="button-row">
                        <button id="btn-clear" class="btn-control" style="background: #fee2e2; border-color: #fecaca; color: #ef4444;">Clear Tree</button>
                    </div>
                </div>
            </aside>

            <div class="canvas-wrapper" id="canvas-container">
                <div id="viz-canvas" style="width: 100%; height: 100%;"></div>
            </div>

            <aside class="sidebar-right">
                <div class="panel" style="flex: 1; display: flex; flex-direction: column;">
                    <h3>Status</h3>
                    <p id="step-desc">
                        Tree empty. Insert a value to start.
                    </p>
                    
                    <div class="legend" style="margin-top: auto;">
                        <div class="legend-item"><span class="color-box bg-yellow"></span> Visiting</div>
                        <div class="legend-item"><span class="color-box bg-green"></span> Found / Inserted</div>
                    </div>
                </div>
            
                <div class="panel" style="flex: 0 0 auto;">
                    <h3>Traversals</h3>
                    <div class="button-row" style="margin-top: 0.5rem;">
                        <button id="btn-inorder" class="btn-control" style="font-size: 0.7rem;">In-Order</button>
                        <button id="btn-preorder" class="btn-control" style="font-size: 0.7rem;">Pre-Order</button>
                        <button id="btn-postorder" class="btn-control" style="font-size: 0.7rem;">Post-Order</button>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <footer>
        <p>Data-structure-visualization Â· <a href="https://github.com/benjikuo/Data-structure-visualization" target="_blank">View on GitHub</a></p>
    </footer>

    <script src="../assets/js/p5.min.js"></script>
    <script src="../assets/js/utils/helpers.js"></script>
    <script src="../assets/js/core/AnimationStep.js"></script>
    <script src="../assets/js/core/Visualizer.js"></script>
    
    <script src="../assets/js/modules/tree/BST.js"></script>

    <script>
        let viz;
        let bst;

        const elInput = document.getElementById('val-input');
        const elSpeed = document.getElementById('speed-slider');
        const elDesc = document.getElementById('step-desc');

        window.onload = () => {
            setTimeout(() => {
                viz = new Visualizer('viz-canvas');
                bst = new BST();
                
                viz.setSpeed(parseInt(elSpeed.value));
                setupEvents();
            }, 100);
        };

        function setupEvents() {
            elSpeed.oninput = (e) => viz.setSpeed(parseInt(e.target.value));

            document.getElementById('btn-rand').onclick = () => {
                elInput.value = Math.floor(Math.random() * 99) + 1;
            };

            document.getElementById('btn-insert').onclick = () => {
                const randomVal = Math.floor(Math.random() * 99) + 1;
                elInput.value = randomVal;
                const steps = bst.insert(randomVal);
                playAnimation(steps);
            };

            document.getElementById('btn-search').onclick = () => {
                const val = parseInt(elInput.value);
                if (isNaN(val)) return;

                const steps = bst.search(val);
                playAnimation(steps);
            };

            document.getElementById('btn-clear').onclick = () => {
                bst = new BST();
                viz.steps = [];
                viz.p5.background(255);
                elDesc.innerText = "Tree cleared.";
            };

            document.getElementById('btn-inorder').onclick = () => playAnimation(bst.traverse('inorder'));
            document.getElementById('btn-preorder').onclick = () => playAnimation(bst.traverse('preorder'));
            document.getElementById('btn-postorder').onclick = () => playAnimation(bst.traverse('postorder'));
            
            document.addEventListener('viz-update', (e) => {
                elDesc.innerText = e.detail.description;
            });
        }

        function playAnimation(steps) {
            if (!steps || steps.length === 0) return;
            viz.steps = steps;
            viz.currentStepIndex = 0;
            viz.play();
        }
    </script>
</body>
</html>
